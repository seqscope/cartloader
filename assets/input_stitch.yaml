# This is an example input yaml file for `cartloader stepinator` function.

#=========================
# Environment configuration
#=========================
## ENV
env:
  spatula: "/path/to/spatula"
  tippecanoe: "/path/to/tippecanoe"
  pmtiles: "/path/to/pmtiles"
  hpc_modules:
  - aws-cli
  - gcc
  - gdal
  - imagemagick/7.1.0-25.lua
  conda: {}

#=========================
# AWS settings
#=========================
# Provide a bucket name to upload results:
# Output will be stored in S3://<aws_bucket>/<run_id>
aws_bucket: <aws_bucket_name>

#=========================
# SLURM settings (optional)
#=========================
# Fill in if running on SLURM. Omit for local runs.
slurm:
  account: <slurm_account>        # SLURM account name
  partition: <slurm_partition>    # SLURM partition
  mail_user: "weiqiuc@umich.edu"  # Notification email
  cpus_per_task: 10               # CPUs per task
  mem: "6500mb"                   # Memory per task
  hours: 24                       # Walltime in hours


#===============
# Output parameters
#===============
out_dir: "/path/to/output/dir"

#===============
# Input parameters
#===============
# Input SGE information 
# * This example aims to use sge_stitch to create a combined SGE
SGE:
  in_tiles:
  - in_csv: /path/to/input/sample1/transcript.unsorted.tsv.gz
    in_feature: null
    in_minmax: null
    row: '1'
    col: '1'
  - in_csv: /path/to/input/sample2/transcript.unsorted.tsv.gz
    in_feature: null
    in_minmax: null
    row: '1'
    col: '2'
  - in_csv: /path/to/input/sample3/transcript.unsorted.tsv.gz
    in_feature: null
    in_minmax: null
    row: '1'
    col: '3'
  - in_csv: /path/to/input/sample4/transcript.unsorted.tsv.gz
    in_feature: null
    in_minmax: null
    row: '2'
    col: '1'
  - in_csv: /path/to/input/sample5/transcript.unsorted.tsv.gz
    in_feature: null
    in_minmax: null
    row: '2'
    col: '2'
  - in_csv: /path/to/input/sample6/transcript.unsorted.tsv.gz
    in_feature: null
    in_minmax: null
    row: '2'
    col: '3'
  colname_count: gn                # Column name for gene counts
  units_per_um: 1000.0             #  ## Coordinate units per micrometer. If scale_json is provided, skip this parameter.

# Input histology image
HISTOLOGY:
- hist_id: HnE
  in_tiles:
  - path: /path/to/input/sample1/hne.tif
    rotate: '90'
    flip: vertical
    row: 1
    col: 1
    transform: false
    georeference: false
  - path: /path/to/input/sample2/hne.tif
    rotate: '90'
    flip: vertical
    row: 1
    col: 2
    transform: false
    georeference: false
  - path: /path/to/input/sample3/hne.tif
    rotate: '90'
    flip: vertical
    row: 1
    col: 3
    transform: false
    georeference: false
  - path: /path/to/input/sample4/hne.tif
    rotate: '90'
    flip: vertical
    row: 2
    col: 1
    transform: false
    georeference: false
  - path: /path/to/input/sample5/hne.tif
    rotate: '90'
    flip: vertical
    row: 2
    col: 2
    transform: false
    georeference: false
  - path: /path/to/input/sample6/hne.tif
    rotate: '90'
    flip: vertical
    row: 2
    col: 3
    transform: false
    georeference: false

#=========================
# Analysis runs
#=========================
RUNS:
- run_id: <run_id>
  train_width: 18,24,36
  exclude_feature_regex: '^(MT-|mt-|Gm\d+$)'
  n_factor: 6,12,24
  filter_by_density: false
  lda_plot_um_per_pixel: 1.0
  fit_plot_um_per_pixel: 1.0
  decode_plot_um_per_pixel: 0.5
  radius_buffer: 1
